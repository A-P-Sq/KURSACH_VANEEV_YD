<Window x:Class="AutoShopCoursework.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d"
        Title="Автомагазин — Управление" Height="700" Width="1100" 
        WindowStartupLocation="CenterScreen" Background="#F4F7F9">

    <Window.Resources>
        <SolidColorBrush x:Key="PrimaryActionBrush" Color="#2D5A9E"/>
        <SolidColorBrush x:Key="SecondaryActionBrush" Color="#546E7A"/>
        <SolidColorBrush x:Key="DangerActionBrush" Color="#E57373"/>
        <SolidColorBrush x:Key="SuccessActionBrush" Color="#81C784"/>

        <Style TargetType="Button">
            <Setter Property="Background" Value="{StaticResource PrimaryActionBrush}"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Height" Value="35"/>
            <Setter Property="Width" Value="150"/>
            <Setter Property="Margin" Value="5"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" CornerRadius="6" SnapsToDevicePixels="True">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Opacity" Value="0.8"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <Style TargetType="TextBox">
            <Setter Property="Height" Value="28"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
            <Setter Property="Padding" Value="5,0"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="TextBox">
                        <Border BorderBrush="#CFD8DC" BorderThickness="1" CornerRadius="4" Background="White">
                            <ScrollViewer x:Name="PART_ContentHost"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style TargetType="DataGrid">
            <Setter Property="Background" Value="White"/>
            <Setter Property="BorderBrush" Value="#CFD8DC"/>
            <Setter Property="RowHeight" Value="32"/>
            <Setter Property="GridLinesVisibility" Value="Horizontal"/>
            <Setter Property="HorizontalGridLinesBrush" Value="#ECEFF1"/>
            <Setter Property="HeadersVisibility" Value="Column"/>
        </Style>

        <Style TargetType="ComboBox">
            <Setter Property="Height" Value="30"/>
            <Setter Property="Margin" Value="0,0,0,15"/>
        </Style>
        <Style TargetType="DatePicker">
            <Setter Property="Height" Value="30"/>
            <Setter Property="Margin" Value="0,0,0,25"/>
        </Style>
    </Window.Resources>

    <Grid>
        <Button Content="Выход" 
                Click="BtnLogout_Click" 
                VerticalAlignment="Top" 
                HorizontalAlignment="Right" 
                Width="110" 
                Height="30" 
                Panel.ZIndex="1" 
                Margin="0,5,15,0"
                Background="{StaticResource DangerActionBrush}"
                FontSize="12"/>

        <TabControl Name="MainTabControl" BorderThickness="0,1,0,0" Background="Transparent">

            <TabItem Header="Автомобили">
                <Grid Margin="15">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <Border Background="White" CornerRadius="8" Padding="10" Margin="0,0,0,15">
                        <StackPanel Orientation="Horizontal">
                            <StackPanel Margin="5">
                                <TextBlock Text="Бренд" FontSize="11" Foreground="#78909C" Margin="0,0,0,3"/>
                                <TextBox Name="txtSearchBrand" Width="140"/>
                            </StackPanel>
                            <StackPanel Margin="5">
                                <TextBlock Text="Модель" FontSize="11" Foreground="#78909C" Margin="0,0,0,3"/>
                                <TextBox Name="txtSearchModel" Width="140"/>
                            </StackPanel>
                            <StackPanel Margin="5">
                                <TextBlock Text="Год" FontSize="11" Foreground="#78909C" Margin="0,0,0,3"/>
                                <TextBox Name="txtSearchYear" Width="80"/>
                            </StackPanel>
                            <Button Content="Поиск" Click="BtnSearchCars_Click" Width="100" VerticalAlignment="Bottom" Margin="10,5"/>
                            <Button Content="Сброс" Click="BtnResetCars_Click" Width="100" VerticalAlignment="Bottom" Background="{StaticResource SecondaryActionBrush}"/>
                        </StackPanel>
                    </Border>

                    <DataGrid Name="dgCars" Grid.Row="1" AutoGenerateColumns="False" IsReadOnly="True" SelectionMode="Single">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="ID" Binding="{Binding id}" Width="50"/>
                            <DataGridTextColumn Header="Марка" Binding="{Binding brand}" Width="*"/>
                            <DataGridTextColumn Header="Модель" Binding="{Binding model}" Width="*"/>
                            <DataGridTextColumn Header="Год выпуска" Binding="{Binding year}" Width="100"/>
                            <DataGridTextColumn Header="Цена" Binding="{Binding price, StringFormat={}{0:N0} руб.}" Width="120"/>
                            <DataGridCheckBoxColumn Header="Продано" Binding="{Binding is_sold}" Width="80"/>
                        </DataGrid.Columns>
                    </DataGrid>

                    <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,15,0,0">
                        <Button Content="Добавить" Click="BtnAddCar_Click" Background="{StaticResource SuccessActionBrush}"/>
                        <Button Content="Редактировать" Click="BtnEditCar_Click" Background="{StaticResource PrimaryActionBrush}"/>
                        <Button Content="Удалить" Click="BtnDeleteCar_Click" Background="{StaticResource DangerActionBrush}"/>
                    </StackPanel>
                </Grid>
            </TabItem>

            <TabItem Header="Клиенты">
                <Grid Margin="15">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="320"/>
                    </Grid.ColumnDefinitions>

                    <DataGrid Name="dgClients" AutoGenerateColumns="False" IsReadOnly="True" SelectionMode="Single" SelectionChanged="dgClients_SelectionChanged">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="ID" Binding="{Binding id}" Width="50"/>
                            <DataGridTextColumn Header="ФИО Клиента" Binding="{Binding fullname}" Width="*"/>
                            <DataGridTextColumn Header="Номер телефона" Binding="{Binding phone}" Width="150"/>
                        </DataGrid.Columns>
                    </DataGrid>

                    <Border Grid.Column="1" Background="White" CornerRadius="8" Margin="15,0,0,0" Padding="20">
                        <StackPanel>
                            <TextBlock Text="Управление клиентами" FontSize="16" FontWeight="Bold" Margin="0,0,0,20" Foreground="#263238"/>
                            <TextBlock Text="ФИО" Foreground="#78909C" Margin="0,0,0,5"/>
                            <TextBox Name="txtClientName" Margin="0,0,0,15"/>
                            <TextBlock Text="Телефон" Foreground="#78909C" Margin="0,0,0,5"/>
                            <TextBox Name="txtClientPhone" Margin="0,0,0,25"/>
                            <Button Content="Добавить" Click="BtnAddClient_Click" Width="240" Background="{StaticResource SuccessActionBrush}"/>
                            <Button Content="Сохранить" Click="BtnEditClient_Click" Width="240" Background="{StaticResource PrimaryActionBrush}"/>
                            <Button Content="Удалить" Click="BtnDeleteClient_Click" Width="240" Background="{StaticResource DangerActionBrush}"/>
                        </StackPanel>
                    </Border>
                </Grid>
            </TabItem>

            <TabItem Header="Продажи" x:Name="TabSales">
                <Grid Margin="15">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="320"/>
                    </Grid.ColumnDefinitions>

                    <DockPanel Grid.Column="0">
                        <Border DockPanel.Dock="Top" Background="White" CornerRadius="6" Padding="10" Margin="0,0,0,10">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="Поиск клиента:" VerticalAlignment="Center" Margin="0,0,10,0" Foreground="#78909C"/>
                                <TextBox x:Name="txtSearchSaleClient" Width="250" TextChanged="TxtSearchSaleClient_TextChanged"/>
                            </StackPanel>
                        </Border>
                        <DataGrid x:Name="dgSales" AutoGenerateColumns="False" IsReadOnly="True" SelectionChanged="dgSales_SelectionChanged">
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="ID" Binding="{Binding sale_id}" Width="40"/>
                                <DataGridTextColumn Header="Марка" Binding="{Binding car_brand}" Width="*"/>
                                <DataGridTextColumn Header="Модель" Binding="{Binding car_model}" Width="*"/>
                                <DataGridTextColumn Header="Клиент" Binding="{Binding client_fullname}" Width="1.5*"/>
                                <DataGridTextColumn Header="Сумма" Binding="{Binding price_sold, StringFormat={}{0:N0} руб.}" Width="100"/>
                                <DataGridTextColumn Header="Дата" Binding="{Binding sale_date, StringFormat=\{0:dd.MM.yyyy\}}" Width="100"/>
                            </DataGrid.Columns>
                        </DataGrid>
                    </DockPanel>

                    <Border Grid.Column="1" Background="White" CornerRadius="8" Margin="15,0,0,0" Padding="20">
                        <ScrollViewer VerticalScrollBarVisibility="Auto">
                            <StackPanel>
                                <TextBlock Text="Новая продажа" FontSize="16" FontWeight="Bold" Margin="0,0,0,20" Foreground="#263238"/>
                                <TextBlock Text="Автомобиль" Foreground="#78909C" Margin="0,0,0,5"/>
                                <ComboBox x:Name="cbCars" DisplayMemberPath="display_name" SelectedValuePath="id" SelectionChanged="cbCars_SelectionChanged"/>
                                <TextBlock Text="Клиент" Foreground="#78909C" Margin="0,0,0,5"/>
                                <ComboBox x:Name="cbClients" DisplayMemberPath="fullname" SelectedValuePath="id"/>
                                <TextBlock Text="Сумма сделки" Foreground="#78909C" Margin="0,0,0,5"/>
                                <TextBox x:Name="txtSalePrice" Margin="0,0,0,15"/>
                                <TextBlock Text="Дата" Foreground="#78909C" Margin="0,0,0,5"/>
                                <DatePicker x:Name="dpSaleDate"/>
                                <Button Content="Оформить" Click="BtnAddSale_Click" Width="240" Background="{StaticResource SuccessActionBrush}"/>
                                <Button Content="Удалить запись" Click="BtnDeleteSale_Click" Width="240" Background="{StaticResource DangerActionBrush}"/>
                            </StackPanel>
                        </ScrollViewer>
                    </Border>
                </Grid>
            </TabItem>

            <TabItem Header="Журнал">
                <Grid Margin="15">
                    <DataGrid Name="dgLog" AutoGenerateColumns="False" IsReadOnly="True">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="ID записи" Binding="{Binding id}" Width="80"/>
                            <DataGridTextColumn Header="ID сделки" Binding="{Binding sale_id}" Width="80"/>
                            <DataGridTextColumn Header="Событие" Binding="{Binding action}" Width="*"/>
                            <DataGridTextColumn Header="Дата и время" Binding="{Binding log_date, StringFormat=\{0:dd.MM.yyyy HH:mm\}}" Width="160"/>
                        </DataGrid.Columns>
                    </DataGrid>
                </Grid>
            </TabItem>

            <TabItem Header="Пользователи" Name="TabUsers">
                <Grid Margin="15">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="320"/>
                    </Grid.ColumnDefinitions>

                    <DataGrid Name="dgUsers" AutoGenerateColumns="False" IsReadOnly="True" 
                              SelectionMode="Single" SelectionChanged="dgUsers_SelectionChanged">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="ID" Binding="{Binding id}" Width="50"/>
                            <DataGridTextColumn Header="Логин" Binding="{Binding login}" Width="*"/>
                            <DataGridTextColumn Header="Пароль" Binding="{Binding password}" Width="*"/>
                            <DataGridTextColumn Header="Роль" Binding="{Binding role}" Width="*"/>
                        </DataGrid.Columns>
                    </DataGrid>

                    <Border Grid.Column="1" Background="White" CornerRadius="8" Margin="15,0,0,0" Padding="20">
                        <StackPanel>
                            <TextBlock Text="Управление доступом" FontSize="16" FontWeight="Bold" Margin="0,0,20,20" Foreground="#263238"/>
                            <TextBlock Text="Логин" Foreground="#78909C" Margin="0,0,0,5"/>
                            <TextBox Name="txtUserLogin" Margin="0,0,0,15"/>
                            <TextBlock Text="Пароль" Foreground="#78909C" Margin="0,0,0,5"/>
                            <TextBox Name="txtUserPassword" Margin="0,0,0,15"/>
                            <TextBlock Text="Роль" Foreground="#78909C" Margin="0,0,0,5"/>
                            <ComboBox Name="cbUserRole" DisplayMemberPath="name" SelectedValuePath="id"/>
                            <Button Content="Создать пользователя" Click="BtnAddUser_Click" Width="240" Margin="0,10,0,5" Background="{StaticResource SuccessActionBrush}"/>
                            <Button Content="Обновить данные" Click="BtnEditUser_Click" Width="240" Margin="0,5" Background="{StaticResource PrimaryActionBrush}"/>
                            <Button Content="Удалить" Click="BtnDeleteUser_Click" Width="240" Margin="0,5" Background="{StaticResource DangerActionBrush}"/>
                        </StackPanel>
                    </Border>
                </Grid>
            </TabItem>

        </TabControl>
    </Grid>
</Window>